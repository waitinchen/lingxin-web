# éˆä¿¡ 2.0 é …ç›®çµæ§‹èªªæ˜

```
lingxin-2.0-deploy-package/
â”œâ”€â”€ ğŸ“„ README.md                     # é …ç›®ç¸½è¦½å’Œå¿«é€Ÿé–‹å§‹æŒ‡å—
â”œâ”€â”€ ğŸ“„ DEPLOY_GUIDE.md              # è©³ç´°éƒ¨ç½²èªªæ˜æ–‡æª”
â”œâ”€â”€ ğŸ“„ .env.example                 # ç’°å¢ƒè®Šæ•¸é…ç½®æ¨¡æ¿
â”œâ”€â”€ ğŸ“„ install.sh                   # å¿«é€Ÿå®‰è£è…³æœ¬
â”œâ”€â”€ ğŸ“„ PROJECT_STRUCTURE.md         # æœ¬æ–‡ä»¶ - é …ç›®çµæ§‹èªªæ˜
â”‚
â”œâ”€â”€ ğŸ“ lingxin-web/                 # å‰ç«¯æ‡‰ç”¨ï¼ˆåŸºæ–¼ Element Web å®¢è£½åŒ–ï¼‰
â”‚   â”œâ”€â”€ ğŸ“„ package.json             # é …ç›®ä¾è³´å’Œè…³æœ¬
â”‚   â”œâ”€â”€ ğŸ“„ vite.config.ts          # Vite æ§‹å»ºé…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ tailwind.config.js      # TailwindCSS é…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ tsconfig.json           # TypeScript é…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ index.html              # æ‡‰ç”¨ç¨‹å¼å…¥å£ HTML
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ src/                     # æºä»£ç¢¼ç›®éŒ„
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ App.tsx              # ä¸»æ‡‰ç”¨çµ„ä»¶
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ main.tsx             # æ‡‰ç”¨ç¨‹å¼å…¥å£é»
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ App.css              # å…¨å±€æ¨£å¼
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ index.css            # åŸºç¤æ¨£å¼
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ components/          # React çµ„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ ui/              # UI åŸºç¤çµ„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ auth/            # èªè­‰ç›¸é—œçµ„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ chat/            # èŠå¤©ç•Œé¢çµ„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ layout/          # å¸ƒå±€çµ„ä»¶
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ pages/               # é é¢çµ„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ LoginPage.tsx    # ç™»å…¥é é¢
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ChatPage.tsx     # èŠå¤©ä¸»é é¢
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ResetPasswordPage.tsx # å¯†ç¢¼é‡ç½®é é¢
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ ProfilePage.tsx  # ç”¨æˆ¶è³‡æ–™é é¢
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ contexts/            # React Context
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ AuthContext.tsx  # èªè­‰ç‹€æ…‹ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ ChatContext.tsx  # èŠå¤©ç‹€æ…‹ç®¡ç†
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ hooks/               # è‡ªå®šç¾© React Hooks
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ useAuth.ts       # èªè­‰ç›¸é—œ hooks
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ useChat.ts       # èŠå¤©ç›¸é—œ hooks
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ useSupabase.ts   # Supabase ç›¸é—œ hooks
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“ lib/                 # å·¥å…·å‡½æ•¸å’Œé…ç½®
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ supabase.ts      # Supabase å®¢æˆ¶ç«¯é…ç½®
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ auth.ts          # èªè­‰å·¥å…·å‡½æ•¸
â”‚   â”‚       â””â”€â”€ ğŸ“„ utils.ts         # é€šç”¨å·¥å…·å‡½æ•¸
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ public/                  # éœæ…‹è³‡æº
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ favicon.ico          # ç¶²ç«™åœ–æ¨™
â”‚   â”‚   â””â”€â”€ ğŸ“„ manifest.json        # PWA é…ç½®
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ dist/                    # æ§‹å»ºè¼¸å‡ºç›®éŒ„ï¼ˆæ§‹å»ºå¾Œç”Ÿæˆï¼‰
â”‚       â”œâ”€â”€ ğŸ“„ index.html           # ç”Ÿç”¢ç‰ˆæœ¬ HTML
â”‚       â””â”€â”€ ğŸ“ assets/              # å„ªåŒ–å¾Œçš„éœæ…‹è³‡æº
â”‚
â”œâ”€â”€ ğŸ“ supabase/                    # Supabase å¾Œç«¯é…ç½®
â”‚   â”œâ”€â”€ ğŸ“ functions/               # Edge Functionsï¼ˆä¼ºæœå™¨ç«¯å‡½æ•¸ï¼‰
â”‚   â”‚   â”œâ”€â”€ ğŸ“ chat-api/            # èŠå¤© API è™•ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ index.ts         # èŠå¤©åŠŸèƒ½ä¸»é‚è¼¯
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ supabase.ts      # Supabase å®¢æˆ¶ç«¯
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ google-oauth/        # Google OAuth è™•ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ index.ts         # OAuth èªè­‰é‚è¼¯
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ supabase.ts      # è³‡æ–™åº«æ“ä½œ
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ commitment-engine/   # æ‰¿è«¾å¼•æ“ï¼ˆMark-1ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ index.ts         # æ‰¿è«¾è§£æå’Œèª¿åº¦
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ parser.ts        # æ‰¿è«¾å…§å®¹è§£æ
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ memory-system/       # ä¹éˆè¨˜æ†¶ç³»çµ±
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ index.ts         # è¨˜æ†¶ç®¡ç†ä¸»é‚è¼¯
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ summarizer.ts    # å…§å®¹æ‘˜è¦åŠŸèƒ½
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ notion-sync/         # Notion å…§å®¹åŒæ­¥
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ index.ts         # Notion API é›†æˆ
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ content-sync.ts  # å…§å®¹åŒæ­¥é‚è¼¯
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ ics-calendar/        # ICS è¡Œäº‹æ›†åŠŸèƒ½
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ index.ts         # æ—¥æ›†ç”Ÿæˆå’Œè¨‚é–±
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ ics-generator.ts # ICS æ ¼å¼ç”Ÿæˆ
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ cron-scheduler/      # å®šæ™‚ä»»å‹™èª¿åº¦
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ index.ts         # Worker ä»»å‹™ç³»çµ±
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“ create-admin-user/   # ç®¡ç†å“¡ç”¨æˆ¶å‰µå»º
â”‚   â”‚       â””â”€â”€ ğŸ“„ index.ts         # åˆå§‹åŒ–ç®¡ç†å“¡å¸³æˆ¶
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ tables/                  # è³‡æ–™åº«è¡¨çµæ§‹ SQL
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ users.sql            # ç”¨æˆ¶åŸºæœ¬è³‡æ–™è¡¨
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ user_identities.sql  # ç”¨æˆ¶èº«ä»½èªè­‰è¡¨
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ user_profiles.sql    # ç”¨æˆ¶è©³ç´°è³‡æ–™è¡¨
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ audit_login_events.sql # ç™»å…¥å¯©è¨ˆæ—¥èªŒ
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ messages.sql         # èŠå¤©æ¶ˆæ¯è¨˜éŒ„
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ memory_summaries.sql # è¨˜æ†¶æ‘˜è¦è¡¨
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ scheduled_nudges.sql # é å®šæé†’è¡¨
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ nudges_log.sql       # æé†’åŸ·è¡Œæ—¥èªŒ
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ nudge_prefs.sql      # æé†’åå¥½è¨­ç½®
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ personas.sql         # AI äººæ ¼å®šç¾©
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ persona_prompts.sql  # AI å’’èªæç¤ºè©
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ user_persona_prefs.sql # ç”¨æˆ¶äººæ ¼åå¥½
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ start_phrases.sql    # æ™ºèƒ½å•Ÿå‹•è©
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ datasets.sql         # è¨“ç·´æ•¸æ“šé›†
â”‚   â”‚   â””â”€â”€ ğŸ“„ guardrails.sql       # å®‰å…¨é˜²è­·è¦å‰‡
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ migrations/              # è³‡æ–™åº«é·ç§»æ–‡ä»¶
â”‚       â”œâ”€â”€ ğŸ“„ 1757050801_enable_rls_policies.sql    # å•Ÿç”¨ RLS
â”‚       â”œâ”€â”€ ğŸ“„ 1757050819_create_rls_policies.sql    # å‰µå»º RLS æ”¿ç­–
â”‚       â”œâ”€â”€ ğŸ“„ 1757050837_create_admin_rls_policies.sql # ç®¡ç†å“¡æ¬Šé™
â”‚       â”œâ”€â”€ ğŸ“„ 1757079219_add_conversation_id_to_messages.sql # å°è©± ID
â”‚       â””â”€â”€ ğŸ“„ 1757079260_fix_message_role_column.sql # ä¿®å¾©æ¶ˆæ¯è§’è‰²æ¬„ä½
â”‚
â””â”€â”€ ğŸ“ docs/                        # é …ç›®æ–‡æª”
    â””â”€â”€ ğŸ“„ éˆä¿¡_2.0_é–‹ç™¼è¨ˆç•«_å…§å®¹.md # åŸå§‹è¨­è¨ˆæ–‡æª”
```

## æ ¸å¿ƒçµ„ä»¶èªªæ˜

### ğŸ¨ å‰ç«¯æ¶æ§‹ (lingxin-web/)

**æŠ€è¡“æ£§ï¼š**
- **React 18** + **TypeScript** - ä¸»æ¡†æ¶
- **Vite** - æ§‹å»ºå·¥å…·å’Œé–‹ç™¼ä¼ºæœå™¨
- **TailwindCSS** - æ¨£å¼æ¡†æ¶
- **Supabase JS** - å¾Œç«¯å®¢æˆ¶ç«¯
- **React Router** - è·¯ç”±ç®¡ç†

**é—œéµç‰¹æ€§ï¼š**
- åŸºæ–¼ Element Web çš„å®¢è£½åŒ– UI
- éŸ¿æ‡‰å¼è¨­è¨ˆï¼Œæ”¯æ´æ‰‹æ©Ÿå’Œæ¡Œé¢
- PWA æ”¯æ´ï¼ˆæ¼¸é€²å¼ç¶²è·¯æ‡‰ç”¨ï¼‰
- æ¨¡çµ„åŒ–çµ„ä»¶æ¶æ§‹
- TypeScript é¡å‹å®‰å…¨

### âš™ï¸ å¾Œç«¯æ¶æ§‹ (supabase/)

**Edge Functionsï¼š**
- **chat-api** - è™•ç† AI å°è©±é‚è¼¯
- **google-oauth** - Google èªè­‰æµç¨‹
- **commitment-engine** - æ‰¿è«¾è§£æå’Œè¿½è¹¤
- **memory-system** - æ™ºèƒ½è¨˜æ†¶ç®¡ç†
- **notion-sync** - Notion å…§å®¹é›†æˆ
- **ics-calendar** - æ—¥æ›†è¨‚é–±åŠŸèƒ½

**è³‡æ–™åº«è¨­è¨ˆï¼š**
- **ç”¨æˆ¶ç³»çµ±** - å¤šé‡èªè­‰æ”¯æ´
- **èŠå¤©ç³»çµ±** - æ¶ˆæ¯è¨˜éŒ„å’Œæœƒè©±ç®¡ç†
- **è¨˜æ†¶ç³»çµ±** - ä¸‰å±¤è¨˜æ†¶æ¶æ§‹
- **æ‰¿è«¾ç³»çµ±** - ä»»å‹™è¿½è¹¤å’Œæé†’
- **æ¬Šé™ç³»çµ±** - ä¸‰å±¤ç®¡ç†æ¬Šé™

### ğŸ›¡ï¸ å®‰å…¨æ¶æ§‹

**èªè­‰æ–¹å¼ï¼š**
- Google OAuth 2.0
- Email + å¯†ç¢¼
- æœƒè©±ç®¡ç†
- JWT Token é©—è­‰

**è³‡æ–™å®‰å…¨ï¼š**
- Row Level Security (RLS)
- API é‡‘é‘°ä¿è­·
- HTTPS å¼·åˆ¶åŠ å¯†
- è¼¸å…¥é©—è­‰å’Œæ¸…ç†

## é–‹ç™¼å·¥ä½œæµç¨‹

### ğŸš€ å¿«é€Ÿé–‹å§‹
```bash
# 1. ä½¿ç”¨å®‰è£è…³æœ¬
chmod +x install.sh
./install.sh

# 2. æˆ–æ‰‹å‹•å®‰è£
cd lingxin-web
pnpm install
cp ../.env.example .env.local
# ç·¨è¼¯ .env.local é…ç½®
pnpm dev
```

### ğŸ”§ é–‹ç™¼æŒ‡ä»¤
```bash
# é–‹ç™¼ä¼ºæœå™¨
pnpm dev

# é¡å‹æª¢æŸ¥
pnpm type-check

# ä»£ç¢¼æª¢æŸ¥
pnpm lint

# æ ¼å¼åŒ–ä»£ç¢¼
pnpm format

# æ§‹å»ºç”Ÿç”¢ç‰ˆæœ¬
pnpm build

# é è¦½æ§‹å»ºçµæœ
pnpm preview
```

### ğŸ“¦ éƒ¨ç½²æµç¨‹
```bash
# 1. è¨­ç½® Supabase é …ç›®
# 2. éƒ¨ç½² Edge Functions
# 3. é…ç½®è³‡æ–™åº«
# 4. è¨­ç½® Google OAuth
# 5. æ§‹å»ºå‰ç«¯
pnpm build
# 6. éƒ¨ç½²åˆ°ç›®æ¨™å¹³å°
```

## æ“´å±•é–‹ç™¼

### æ–°å¢å‰ç«¯åŠŸèƒ½
1. åœ¨ `src/components/` å‰µå»ºæ–°çµ„ä»¶
2. åœ¨ `src/pages/` æ·»åŠ æ–°é é¢
3. æ›´æ–° `src/App.tsx` è·¯ç”±é…ç½®
4. æ·»åŠ ç›¸æ‡‰çš„ TypeScript é¡å‹

### æ–°å¢å¾Œç«¯åŠŸèƒ½
1. åœ¨ `supabase/functions/` å‰µå»ºæ–° Edge Function
2. åœ¨ `supabase/tables/` æ·»åŠ è³‡æ–™åº«è¡¨çµæ§‹
3. å‰µå»ºç›¸æ‡‰çš„ RLS æ”¿ç­–
4. æ›´æ–°å‰ç«¯ API èª¿ç”¨

### è‡ªå®šç¾© UI çµ„ä»¶
- åŸºæ–¼ Element Web çš„è¨­è¨ˆç³»çµ±
- ä½¿ç”¨ TailwindCSS é€²è¡Œæ¨£å¼å®šåˆ¶
- æ”¯æ´æ·±è‰²/æ·ºè‰²ä¸»é¡Œåˆ‡æ›
- éŸ¿æ‡‰å¼è¨­è¨ˆæœ€ä½³å¯¦è¸

## æ•…éšœæ’é™¤

å¸¸è¦‹å•é¡Œå’Œè§£æ±ºæ–¹æ¡ˆè«‹åƒè€ƒï¼š
- `README.md` - åŸºæœ¬å•é¡Œ
- `DEPLOY_GUIDE.md` - éƒ¨ç½²ç›¸é—œå•é¡Œ
- Supabase Dashboard Logs - å¾Œç«¯å•é¡Œ
- ç€è¦½å™¨é–‹ç™¼è€…å·¥å…· - å‰ç«¯å•é¡Œ